---
import CardProduct from "../components/CardProduct.astro";
import Header from "../components/Header.astro";
import OrderModal from "../components/OrderModal";
import Layout from "../layouts/Layout.astro";

interface IProducto {
  _id: string;
  nombre: string;
  precio: number;
  stock: number;
  costo?: number;
  imageUrl?: string;
}

let products: IProducto[] = [];

try {
  const response = await fetch("http://localhost:3000/api/product");
  const data = await response.json();
  products = Array.isArray(data) ? data : []; // Aseguramos que sea un array
} catch (error) {
  console.error("‚ùå Error al obtener productos:", error);
}
---

<Layout title="Hamburgueseria">
  <main class="d-flex flex-column align-items-center">
    <Header />
    <OrderModal client:load />

    <h1>Nuestros Productos</h1>
    <section>
      {
        products.length > 0 ? (
          products.map((product) => <CardProduct data={product} />)
        ) : (
          <p>No hay productos disponibles.</p>
        )
      }
    </section>
  </main>
</Layout>
