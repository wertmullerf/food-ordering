---
export const prerender = false; // Desactiva la pre-renderización

import { fetchOrderData } from "../../utils/fetchOrderData";
import type { Producto } from "../../types/Product"; // Importa la interfaz

const { id } = Astro.params; // Accedes al parámetro dinámico "id" desde la URL
const order = await fetchOrderData(id || ""); // Obtienes los datos del pedido utilizando el ID

// Definir el tipo explícito para los productos
let productos: Producto[] = [];

if (order) {
  productos = order.productos;
}
---

<html lang="es">
  <head>
    <title>Pedido {order ? order._id : "No encontrado"}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container my-5">
      {
        order ? (
          <>
            <h1 class="text-center">Detalles del Pedido</h1>
            <div class="card shadow-sm">
              <div class="card-body">
                <h3 class="card-title">Pedido {order._id}</h3>
                <p class="card-text">
                  <strong>Estado:</strong> {order.estatus}
                </p>
                <p class="card-text">
                  <strong>Total:</strong> ${order.total}
                </p>
                <p class="card-text">
                  <strong>Fecha de Creación:</strong>{" "}
                  {new Date(order.createdAt).toLocaleString()}
                </p>

                <h4 class="mt-4">Productos:</h4>
                <ul class="list-group">
                  {productos.map((producto) => (
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <span>{producto.nombre}</span>
                      <span>
                        {producto.cantidad} x ${producto.precio_unitario}
                      </span>
                      <strong>
                        ${producto.cantidad * producto.precio_unitario}
                      </strong>
                    </li>
                  ))}
                </ul>
              </div>
            </div>
          </>
        ) : (
          <div class="alert alert-danger" role="alert">
            Pedido no encontrado.
          </div>
        )
      }
    </div>
  </body>
</html>
